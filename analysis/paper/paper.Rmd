---
title: "Bayesian exponential random graph modeling of KWL Burial network"
author:
  - Author One
  - Author Two
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---


<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/"
)
```

# Introduction

<!--burial study- network analysis-->
Burial analysis has long developed in archaeology to study societies through mortuary practices, such as cultural and biological records in burial contexts, reflecting the social status or identity of the deceased [@Binford1971; @Saxe1970]. Despite the criticism for not considering the burial manipulation by the living or situations of less connection to real life [@Hodder1980; @Pearson1982], burial analysis with a quantitative approach is still effective to answer questions related to social representations with both archaeological contexts of death and life in mind [@Chapman2003]. Mortuary practices include burial forms, grave goods, and related ritual practices that structure the material configuration of burials can represent social relations between members of a community, allowing the inference for social structures [@Byrd1995; @Seikel2011]. The development of network science and graph theory provides many new tools for the study of the relations between burials and exploration of their social implications [@Sosna2013]. This means we can use data from burials to study social differences to answer questions related to social inequality and complexity [@Ehrhardt2009; @Gamble2002; @Janes2013; @Johansen2015]. For example, burial goods can reflect social practices in broader cultural contexts to represent personal wealth, social roles, or traditional customs. Burials with the same mortuary practices may indicate some similar underlying social relations, for example, individuals with grave goods in common that share similar access to trade, exchange, and gifting networks [eg. @Coward2013, pp. 252]. Identifying the structure of relationships among burials can give insights into the structure of social organization.  

To measure relations and patterns underlying the relations, social network analysis (SNA), is a useful method that has been increasingly applied by archaeologists to study relationship between humans, or sites in past societies [@Mills2017]. A social network can be expressed as a graph consisting of a set of socially-relevant nodes, or actors, connected by edges representing one or more relations, for example, friendship, collaborations, information flow, trade ties, or any forms of connection of interest [@Marin2011; @Wasserman1994]. The basic unit of relationship is called a dyad, defined as a connection between two distinct actors [@Lee2016]. In archaeology, actors can be people, groups, objects, places, or events, with ties built on similarity, proximity, and co-presence of material culture based on archaeological theories for relationships [@Mills2017; @Brughmans2018]. This allows answering questions related to interaction and exchange, identities, and power relationships between social groups or archaeological sites by quantifying and visualizing social relations from archaeological data. There are two common approaches of archaeological applications, one is analyzing structures of networks built on archaeological data and finding patterns, and another is modeling theory to represent and test dependence of relationships [@Brughmans2018]. The modeling approach is useful to statistically test hypotheses about the relationships between actors to examine the structure of network and major factors that affect the formation of the structure [@Freeman2004; @Salvini2010]. Those approaches are widely used for different topics, such as exploring hunter-gatherer exchange network in the Kuril Islands based on ceramic compositions [@Erik2015]; long term inter-site relationship from the Epipalaeolithic to the early Neolithic in Near East according to trade items [@Coward2013]; hierarchical communication systems in the Kofun period in Japan through prestige goods [@Mizoguchi2013]. 

<!--archaeology case-->
The archaeological sites in northeastern Taiwan show evidence of use of imported prestige goods in burials and some accumulation patterns in residential area around the same time as European contact in the 17th century [@Chen2007], which might indicate the pursuit of prestige or wealth in those societies. The prestige goods include imported ornaments and porcelains that entered northeastern Taiwan via regional exchange networks involved the Europeans, Han Chinese traders, and Indigenous groups. The concept of prestige goods may develop earlier before the European arrival, but could be amplified during the European colonial period. For example, a person with more imported goods may be treated as higher status. A general model to summarize these case studies might be that the support of a colonial power combined with high local values of imported goods, might lead to increased social inequality due to competition among individuals. In this study, we use a pericolonial model to explain the changes in social inequality at Kiwulan, an Iron Age site in northeastern Taiwan, which covers the time before the European arrival, the presence of the Europeans, including the Spanish and the Dutch, in the 17th century and the Chinese in the 19th century. Our purpose is to identify changes in network structure of burials before and after the foreign contacts, and test our hypothesis that increased inequality observed in social network after the European arrival. This is important to understand how an Indigenous society reacted to the presence of foreign imperial power. 

We applied Bayesian SNA to burial data from Kiwulan, an Iron Age site in northeast Taiwan. We viewed individual burials as actors or nodes in the social network with ties drawn between burials when the presence of the same burial goods that can represent the same social group with similar economic or political status. We construct a network that represents higher social inequality and tested hypotheses that burial relations becomes more hierarchical after the European arrival. We ask the questions: 1. Do the observed burial data after the European presence shows more similar network quality as our hypothesized model? 2. Whether European colonial activities in 17 century Taiwan resulted in the emergence of social inequality in an Indigenous society can be detected by burials networks. 3. What is the major variables affecting or forming the higher degree of popularity (e.g. a few node has more relationship with other nodes) in the European contact period that might hint at social heterogeneity during this period. This study helps to expand the use of burials in understanding the indirect effects of a colonial presence on Indigenous groups. A Bayesian approach enables the efficient quantification for uncertainty, parametrization, and model evaluation of social network metrics.

# Exponential random graph models in a Bayseisan framework

<!--current approaches to network analysis-->
Exponential Random Graph Models (ERGMs) are an important family of statistical models for networks that allows directly modeling for the formation of edges, or ties, between nodes [@Robins2007]. The assumption is that possible ties in a network are random variables and dependent on actor variables or the presence or absence of other ties [@Robins2007]. ERGMs differs from traditional network approaches that edges are only formed according to their corresponding predictors separately without taken into account the interactions among edges [@Morris2008]. In ERGMs, networks are viewed as dependent variables, the formation of a tie is also influenced by network dependencies, and the attributes of nodes/edges [@Snijders2011]. For example, nodes with similar attributes is more likely to form a relationship, such as friendship between people with the same hobby. Ties form a small structure in a network called a graph configuration that describes the form of dependence, such as reciprocity (relationship between two actors), transitivity or clustering (relationship between two actors through a shared third actor), homophily (relationship between actors with a similar attribute), or popularity (actors have many relationships with others) [@Robins2007; @Snijders2006; @Morris2008]. Those configurations represent the structure or the property of a network and can be expressed by network statistics. We can model those network statistics as direct functions of ties, where the probability of occurrence of ties can be specified and hypothesized [@Morris2008; @Robins2007]. By specifying the forms of configurations, we can build a hypothesis-based model to generate a distribution of random networks. Such distribution consists of a large number of possible networks that provides a statistical inference for an observed network [@Robins2007].  This helps to understand whether an observed network shows significantly more or less property of interest than the random networks we modeled. 

ERGMs can describe a network by capturing the dependency structure by specifying parameters under assumptions and contexts, which is useful for exploring archaeological network. For instance, @Amati2019 demonstrated how to reconstruct of three different networks consisting of 15 sites (AD 100 to 400) in the Caribbean to explore their interaction mechanisms using ERGMs. Three network models test different hypotheses for the relationship between sites based on proximity, inter-cultural, and exchange network to explain the presence of hub sites they observed. They found that the presence of hubs can be efficiently explained by multiple interdependent mechanisms instead of only one model exclusively. However, they also pointed out some limitations of ERGMs, such as static outcome and sensitivity to missing data. In addition, it is difficult in ERGMs to estimate model parameters and interpret the result due to the intractable normalizing constant and model degeneracy [@Caimo2014; @Jin2013]. A normalizing constant is an important step to make probability distribution to integrate to one, which becomes harder to compute with larger set of networks [@Caimo2017bayesian]. Degeneracy is another issue that probability models tend to overestimate a small number of extreme graphs by assigning too much weight, such as empty (all nodes unconnected) or complete graphs (all nodes connected) [@Schweinberger2011; @Caimo2014]. Those complex computational processes in ERGMs can be also resolved by implementing ERGMs in a Bayesian framework. 

<!--Bayesian inference for Exponential Random Graph Models--> 
Bayesian approach to ERGMs is an efficient computational tool for social network analysis because it incorporates prior information about the network effects into the model and offers uncertainty quantification by evaluating the posterior distribution of the parameters associated with the network effects [@Caimo2015; @Nemmers2019]. This provides better estimations for complex social network models with heterogeneous data [@Caimo2017]. For archaeological data, missing data could be a problem leading to misinterpretation, which can be also reduced with Bayesian modeling that provides average 80% correct prediction for the ties and allow 25% false with a third of data missing [@Koskinen2010]. To overcome these limitations in ERGMs, Bayesian modeling applies Markov chain Monte Carlo (MCMC) simulation using the approximate exchange algorithm to estimate the double intractable posteriors [@Caimo2011]. MCMC algorithms can produce approximate maximum likelihood estimators and graph statistics for further specification of transitivity and heterogeneity, this enables ERGMs to deal with complicated dependence patterns with a ease [@Snijders2006]. This alleviate above computational problems and gives a better convergence results. By fitting an ERMG with MCMC algorithm, a Bayesian approach provides posterior probability that incorporates our sample data and prior information through summary statistics from estimates of the ERGM parameters. Posterior probability enables the estimation the effect of ERGM parameter by looking at the posterior mean and 95% credible intervals, which can replace p-value for accessing a null hypothesis [@Caimo2017bayesian]. The criteria is that the odds ratio greater than one means positive effect of ERGM parameter, while odds ratio less than one represents negative effect.

# Burial data from Kiwulan, NE Taiwan

```{r read-data}
library(readxl)
library(tidyverse)
library(here)

# read data
burial <- read_excel(here("analysis", "data", "raw_data", "Kiwulan_Burials.xlsx"))
```

```{r tidy-data}
# number of each phase
burial_phases_sample_size <-
  burial %>%
  mutate(Phase = ifelse(Phase == 'euro', 'post', Phase)) %>%
  filter(!is.na(Phase)) %>% 
  count(Phase)

pre_E <- burial_phases_sample_size %>% filter(Phase == "pre") %>% pull()
post_E <- burial_phases_sample_size %>% filter(Phase == "post") %>% pull()
chi <- burial_phases_sample_size %>% filter(Phase == "chi") %>% pull()
```

<!--archaeological setting-->
We analyzed burial data collected from the upper component of Kiwulan site, an Iron Age settlement site (1350-1850 AD) located in northeastern Taiwan, which experienced the European colonial impacts in the early 17th century and the large wave of Chinese immigrants in the 19th century [@Chen2007]. The excavation revealed abundant pottery sherds, imported ceramics and stonewares, wooden artifacts, stone tools, metal artifacts, imported glass beads and agates beads, and pipes [@Chen2007]. In addition to these artifacts, 90 burials, hundreds of middens, storage pits, and postholes with in-situ posts were also excavated. The burials are mostly located in the middle section of the excavation area, which is the largest open area at Kiwulan that provides continuous stratigraphic sections suitable for temporal comparison. Those burials are oriented in an east-west direction on the north side of the residential area indicated by post-holes and `in-situ` wooden posts, indicating a well organized space arrangement. Previous studies point out a presence of uneven distribution of prestige goods across burials without an agreement that whether this uneven distribution hints vertical social differences. @Cheng2008 interpreted the unequal distribution of glass beads, especially the gold-foil beads between burials, as evidence for hierarchy, indicating a stratified society. However, @Hsieh2012 suggested a relatively egalitarian based on the comparative analysis of frequency and proportion of all burial goods. She found that the burials with high valued burial goods were usually associated with elders, which might indicate achieved, rather than inherited, status. 

The earliest record of the use of prestige goods in burials can be traced back to the time when the European arrival in the 17th century according to historical records from the Spanish [@Borao2009; @LiandWu2006]. For example, the document written by a Spanish Priest described that the Spanish soldier used carnelian beads to exchange natural resources with local Indigenous people since their high values in Indigenous culture [@LiandWu2006]. In addition, there was a custom that people would bury imported beads and ceramics with deceased to display their status and influence [@LiandWu2006]. Despite we observed the uneven distribution of prestige goods in burials, the degree of differentiation across burials over time remain unclear. The discord over the discussion of Kiwulan social organization could be associated with chronological differences that has not yet been well studied. That is, the observed uneven distribution may be explained as a result of social change from less social inequality to more social inequality when Indigenous societies in Northeastern Taiwan were involved in the complex trade network stimulated by the Europeans. We assume that the changes would be supported by chronological differences in the structure of burial networks. Analyzing and comparing networks between different phases relative to cultural contact will give an insight into changes in social differences. This is important to understand the reactions of Kiwulan residents in the context of indirect impacts of European colonization. 

<!--chronology-->
To compare burial networks, we assigned burials to the pre-European period (n = `r pre_E`), European and post-European period (n = `r post_E`) for network comparison according to depth, radiocarbon dates, diagnostic materials, stratigraphic data, and previous studies. We excluded the burials from the Chinese phase (n = `r chi`) for analysis due to much smaller sample size. Since the sedimentary characteristics show vertical and lateral continuity cross units of AD section, depth is used as the first criterion for burial chronology. The chronology is then evaluated by the burials with light gray glazed jars, also called An-ping jars that were believed to be produced in Southeast China. They circulated in Southeast Asia from the late 16th to 18th century, and often found at sites with the European occupation in the early 17th century in many Aisan places, including Taiwan [@Berrocal2018; @Hsieh1995; @Ketel2011]. 

In addition to the diagnostic jars, three radiocarbon dates of charcoal associated with three different burials are used as another evidence to evaluate the chronology [@Chen2007]. Some burials that were heavily disturbed by modern construction are excluded to avoid misinterpreting due to incomplete data. With the information of burials, including quantity of grave goods, types of grave goods, burial identities, we can reconstruct social relations between individuals by linking them according to similar prestige goods. This is based on the assumption that the prestige goods imply social practices of trade, exchange, and gifting that reflect social relations between individuals [@Coward2013, pp. 252]. Also, prestige materials usually relate to a representation of social status, where the same economic or social class, tend to use similar goods as a status indicators [citations]. Therefore, we build network where burials represent actors (nodes in the network) that are linked when they have th same prestige goods in common. The prestige goods we identified including agate beads, gold-foil beads, imported Chinese porcelains, gold foils, and fish-shaped ornaments, according to previous research [@Cheng2008; @Hsieh2009; @Hsieh2012; @Wang2011] and the description in historical records [@Borao2009; @LiandWu2006]. 

# Methods

## data and hypothesis

We analyzed burial data collected from the published excavation reports, and the original fieldwork notes of Kiwulan. We assume that the pericolonial impact hypothesis would be supported by changes in network structures build upon flow of resources, prestige goods here. We treat the presence of relations between burials based on number or types of  prestige items from regional trade network. where a few prestige goods controlled by a small number of individuals. This is because prestige items could represent a relationship, where a few prestige goods controlled by a small number of individuals. Based on this assumption, we treat the presence of relations between burials through the burial goods in common.  Given that gold-foil beads and agate beads commonly found across burials with substantial differences in counts, we classified those beads into three levels, high, medium, and low, to indicate quantity based on the distribution of their counts. That means if burial 1 and burial 2 both have high quantity of agate beads, then there will be a tie connecting them. For less frequent prestige goods, including imported porcelains, gold foils, and fish-shaped ornaments, we linked two burials when they possess each type of goods in common. Node attributes here include osteological data and mortuary practices, such as age, gender, ritual practice, and overall burial goods quantity index. Ritual practice is identified by locally made ceramics placed above graves that suggests funeral feasting according to historical records. Quantity index is an important attribute for economical inequality that we assigned the burials into three classes, high, medium, and low, as an index of wealth, based on the total number of burial goods. Since burials tend to have multiple prestige goods in common, the network ties are weighted instead of binary data (where the value 1 represents a tie and the value 0 otherwise) [@Snijders2011]. For example, if two burials have both low quantity of glass beads and porcelain in common, the tie is given a value of 2. Our networks are non-directed, which means ties have no orientation forming the relationship between actors to indicate a mutual relationship.

Our pericolonial impact hypothesis is that restricted grave goods or accumulation of goods present in a few individuals after the European presence in the 17th century, because of increased social inequality at Kiwulan due to differential access high value goods. The high value of trade goods had been identified by the historical documents written by the Europeans and the Han Chinese [@Borao2009; @LiandWu2006]. In addition to the interest of burial goods, the indirect colonialism in northeastern Taiwan may suggest the potentially manipulation of the European colonial image by local ambitious individuals for building their personal status and power. If the social inequality gradually increased in Kiwulan, then we would observe a network with higher degree (popularity), less transitivity (cohesion), and strong inequality based on age difference (achieved status). Network analysis provides a way to examine the underlying mechanisms that shape the relationships between people at Kiwulan, and the effect of foreign contact on these relationships through chronological comparison. 

## Model specification in a Bayesian framework
```{r ergm-terms-table}
ergm_terms <- readxl::read_excel(here("analysis", "data", "raw_data", "ergm_term.xlsx")) 
kableExtra::kable(ergm_terms,
             caption = "The parameters of exponential random graph models for a undirected network to corresponding with archaeological evidence.")
```

<!--Network construction and specification-->
We used Bayesian inference on exponential random graph models (ERGMs) to quantify the relations among burials and test our hypothesis of social change using the R programming language with the bergm package [@Caimo2014], which built upon the statnet package for model specification and simulation procedures [@Hunter2008; @Morris2008; @Handcock2008]. Table \@ref(tab:ergm-terms-table) lists the configurations we used for the model specification for burials with archaeological interpretations. Every parameter in an ERGM has an associated algorithm for computing its value for a network [@Morris2008]. Based on our hypothesis, we model a network with increased social inequality that represented by low reciprocity, low transitivity, high popularity, high age homophily, and less proximity structure effects. We modeled several node attributes for homophily effects, including age, gender, ritual, and the degree of wealth, to explore the correlation between the tendency of connected nodes and the network ties overall. We also take into account the physical distance between burials as an indicator of a kinship-based relation since the deceased from the same family tend to be buried close to each other. Our model infers the presence of a few individuals as centers having more relations with others, which hints the emergence of social inequality. We expect that observed network after the European arrival will have a better match with our model compared with the network before European contact. 

<!--Model fitting and prior setting--> 
After the specification, the network is simulated in a Baysesian framework using Markov chain Monte Carlo (MCMC) algorithm. MCMC algorithm is an estimation of posterior distribution of interest through directly random sampling the posterior without assuming the prior is a normal distribution. We can obtain a distribution by constructing a Markov chain that describes a sequence of moves from current state to the next state following probabilistic rules based on algorithms. This enables a random or stochastic simulation in a long run without depending on the previous move. More chains ensures a more desirable distribution close to the target distribution that we study, which is called the convergence of the Markov chains. In Bayesian ERGMs, MCMC first selects a set of edges (or a set of empty pair of actors) with equal probability, and than switch to a pair of actors at random within the chosen set [@Caimo2011]. In our case, we set the number of chains to six. For each chain, the number of burn-in iterations is 200 and the number of iterations after the burn-in is 2000. We set the number of iterations used to simulate a network y′ at each iteration to 10,000. For prior, the normal distribution is agreed as a suitable prior model in network analysis that assumes networks with low density and high transitivity commonly found in real world [@Caimo2017]. To   

<!-- Goodness-of-fit assessment-->
The models are assessed by goodness-of-fit (GOF) diagnostics in the Bayesian framework, where the observed network is compared with the set of networks simulated from the estimated posterior distribution of the parameters of the model [@Caimo2011; @Caimo2017]. The Bayesian GOF summarized three distributions, including degree, minimum geodesic distance, and edgewise shared partner distributions. This provides a statistical approach to check how well the estimated posterior parameter distribution based on our hypotheses can reproduce networks similar to the general structural features of the observed network. We then compared the distribution of our observed networks, pre-European and post-European networks, with the distribution of our hypothesized model with higher popularity. We expect to see the network after the European presence has a better fit with the hypothesis, indicative of a structure with higher social differentiation. 

# Results

The pre-European network shows three subgroups that possessing the same types of burial goods: medium amount of carnelian bead on the right, medium amount of gold-foil beads on the left, and porcelains in the middle. Although burials with different amount of burial goods can be identified, there is no clear clusters demonstrating the sharing of prestige goods only for burials with rich goods. The post-European network also presented subgroups with more edges connecting burials. 

## ERGM parameter estimation
<!--interpretation of network plots across phases--> 

```{r network-ERGMs}
```

<!--interpretation of Bayesian modeling--> 


```{r Bayesian-ERGMs}
```

## Structure Effects

The network statistics presents each θ that corresponds to the parameter specified in ERGM previously. In general, positive mean indicates positive correlation, while negative mean indicates negative correlation. 

θ1 = number of ties
θ2 = individuals with the same abundance of burial goods
θ3 = gwesp, a positive sign suggests a tendency of burials in our sample to group together in closed transitive structures. In mortuary context, clustering implies a tendency of burials with the same status indicated by prestige goods to be organized in closed structures. Burials with multiple prestige goods in common are more likely to be directed connected.
θ4 = gwdegree, negative estimates reflect an increased likelihood on ties to higher-degree nodes, or the strong edges are not necessarily centralised or dispersed in the degree distribution.

The plots from left to right show estimated marginal posterior densities, trace plots, and auto correlation plots.


```{r Bayesian-gof}
```

Figure shows the Bayesian goodness of fit diagnostics plots where the red lines represent the distributions of the observed data and the box plots represent the GOF distributions of 10000 network graphs simulated from ERGMs based on the estimated posterior distribution. The grey lines mark the 95% intervals. X-axis means the proportion of nodes

# Discussion

<!-- briefly discuss Chinese burials -->
Age and gender attributes serve as indicators for distinguishing ascribed or achieved status in a society [citation]. 


# Conclusion

# Acknowledgments

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
